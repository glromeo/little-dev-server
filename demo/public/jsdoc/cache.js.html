<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: cache.js</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link href="styles/prettify-tomorrow.css" rel="stylesheet" type="text/css">
    <link href="styles/jsdoc-default.css" rel="stylesheet" type="text/css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: cache.js</h1>


    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * TODO: I need to get a better understanding of how caching works, until then...
 * I copied over this from es-dev-server confident somebody knew what was doing there.
 *
 * Returns 304 response for cacheable requests
 *
 * @param {LiteServerConfig} config
 * @param {FSWatcher} watcher
 * @return {Middleware}
 */
function createCacheMiddleware(config, watcher) {

  async function cacheMiddleware(ctx, next) {
    await next();

    if (!ctx.body || ctx.status === 304) {
      return;
    }

    if (!['GET', 'HEAD'].includes(ctx.method)) {
      return;
    }

    if (ctx.status &lt; 200 || ctx.status >= 300) {
      return;
    }

    // let koa check if the respone is still fresh this means
    // the etags of the request and response match, so the browser
    // still has a fresh copy so it doesn't need to re-download it
    if (ctx.fresh) {
      ctx.status = 304;
      ctx.response.remove('content-type');
      ctx.response.remove('content-length');
    }

    // don't send last-modified since it doesn't do microseconds
    ctx.response.remove('last-modified');
  }

  return cacheMiddleware;
}

module.exports = {
  createCacheMiddleware
};</code></pre>
        </article>
    </section>


</div>

<nav>
    <h2><a href="index.html">Home</a></h2>
    <h3>Global</h3>
    <ul>
        <li><a href="global.html#createCacheMiddleware">createCacheMiddleware</a></li>
    </ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.3</a> on Sat Aug 17 2019 18:21:23
    GMT+0100 (British Summer Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
